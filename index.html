<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Star App</title>
<style>
html {
    margin: 0;
    padding: 0;
    height: 100%;
}
body {
    margin: 0;
    padding: 0;
    height: 100%;
}
canvas {
    display: block;
}
img {
    display: none;
}
</style>
</head>
<body>
<canvas id="canvas">
</canvas>
</body>
<script>
var mapName = 'map.png';
var starsName = 'stars.png';
var piscesName = 'pisces.png';
var loadedImagesCount = 0;
var imageNames = [mapName, starsName, piscesName];
var images = {};
var imagesWidth;
var imagesHeight;
var canvas;
var ctx;
function draw() {
    var w = canvas.width;
    var h = canvas.height;
    var wr = w / imagesWidth;
    var hr = h / imagesHeight;
    
    var map = images[mapName];
    var stars = images[starsName];
    var pisces = images[piscesName];

    var scale = wr;
    var dw = w;
    var dh = scale * imagesHeight;
    var x = 0;
    var y = (h - dh) / 2;
    if (hr > wr) {
        dw = hr * imagesWidth;
        dh = h;
        scale = hr;
        x = (w - dw) / 2;
        y = 0; 
    }
    console.log('scale='+scale);

    ctx.drawImage(map,x,y,dw,dh);
    ctx.drawImage(pisces,x,y,dw,dh);
    ctx.drawImage(stars,x,y,dw,dh);
    
    ctx.moveTo(0,0);
    ctx.lineTo(w,h);
    ctx.moveTo(w,0);
    ctx.lineTo(0,h);
    
    ctx.stroke();
}
function resize() {
    var w = window.innerWidth;
    var h = window.innerHeight;
    canvas.width = w * 2;
    canvas.height = h * 2;
    canvas.style.width = w+'px';
    canvas.style.height = h+'px';
    draw();
}
function init() {
    canvas = document.getElementById('canvas');
    ctx = canvas.getContext('2d');
    ctx.scale(2,2);
    window.addEventListener('resize', resize, false);
    var name = imageNames[0];
    var img = images[name];
    imagesWidth = img.naturalWidth;
    imagesHeight = img.naturalHeight;
    resize();
}
function initImages() {
    for (var i = 0; i < imageNames.length; i++) {
        var image = new Image();
        var name = imageNames[i];
        image.src = name;
        image.onload = function() {
            loadedImagesCount++;
            if (loadedImagesCount >= imageNames.length) {
                init();                
            }
        };
        images[name] = image;
    }
}
document.addEventListener('DOMContentLoaded', initImages, false);
</script>
</html>
